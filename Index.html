<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>٦٨٠koora</title>
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <style>
        /* All CSS is correct and remains the same as the previous version */
        :root {
            --bg-primary: #f5f5f5; --bg-secondary: #ffffff; --text-primary: #212121; --text-secondary: #757575; --card-shadow: 0 4px 12px rgba(0,0,0,0.08); --card-hover-shadow: 0 8px 20px rgba(0,0,0,0.12); --border-color: #e0e0e0; --bottom-nav-bg: linear-gradient(to top, #f5f5f5, #ffffff);
            --app-blue: #1976D2; --app-blue-dark: #0D47A1; --live-blue: #0288D1; --header-height: 60px; --footer-height: 70px;
        }
        .dark-mode {
            --bg-primary: #121212; --bg-secondary: #1e1e1e; --text-primary: #e0e0e0; --text-secondary: #aaaaaa; --card-shadow: 0 4px 12px rgba(0,0,0,0.4); --card-hover-shadow: 0 8px 20px rgba(0,0,0,0.5); --border-color: #333333; --bottom-nav-bg: linear-gradient(to top, #1e1e1e, #2c2c2c);
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        *:focus, *:active { outline: none !important; box-shadow: none !important; -webkit-tap-highlight-color: transparent !important; }
        body { font-family: system-ui, sans-serif; background-color: var(--bg-primary); display: flex; justify-content: center; align-items: center; min-height: 100vh; direction: rtl; transition: background-color 0.3s ease; }
        .mobile-container { width: 100%; max-width: 420px; background-color: var(--bg-primary); min-height: 100vh; box-shadow: 0 0 25px rgba(0,0,0,0.15); display: flex; flex-direction: column; position: relative; overflow: hidden; transition: background-color 0.3s ease; }
        .header { background: linear-gradient(to bottom, var(--app-blue), var(--app-blue-dark)); color: white; padding: 10px 15px; display: flex; justify-content: space-between; align-items: center; gap: 10px; position: fixed; top: 0; left: 0; right: 0; width: 100%; max-width: 420px; height: var(--header-height); z-index: 1000; margin: 0 auto; box-shadow: 0 2px 4px rgba(0,0,0,0.1); border-radius: 0 0 20px 20px; }
        .header-left, .header-right { display: flex; align-items: center; }
        .app-logo { width: 35px; height: 35px; border-radius: 50%; background-color: black; background-image: url('https://d.top4top.io/p_3606tuhk40.png'); background-size: cover; background-position: center; border: 2px solid rgba(255,255,255,0.2); }
        .search-bar { flex-grow: 1; background-color: rgba(255,255,255,0.2); border-radius: 25px; padding: 8px 18px; display: flex; align-items: center; color: white; }
        .search-bar input { border: none; outline: none; width: 100%; font-size: 14px; background: transparent; color: white; }
        .search-bar input::placeholder { color: rgba(255,255,255,0.7); }
        .search-bar svg { width: 18px; height: 18px; margin-left: 8px; stroke: white; opacity: 0.8; }
        .lightning-icon svg { width: 24px; height: 24px; fill: white; opacity: 0.9; }
        .content-wrapper { margin-top: var(--header-height); margin-bottom: var(--footer-height); flex-grow: 1; position: relative; }
        .page { position: absolute; top: 0; left: 0; width: 100%; height: 100%; overflow-y: auto; opacity: 0; visibility: hidden; transform: translateX(-20px); transition: opacity 0.3s ease-out, transform 0.3s ease-out, visibility 0.3s; }
        .page.active { opacity: 1; visibility: visible; transform: translateX(0); }
        .top-tabs { background-color: var(--bg-secondary); padding: 12px 15px; display: flex; justify-content: space-around; border-bottom: 1px solid var(--border-color); transition: background-color 0.3s ease, border-color 0.3s ease;}
        .top-tabs span { padding: 6px 12px; font-size: 15px; color: var(--text-secondary); cursor: pointer; border-bottom: 3px solid transparent; transition: all 0.3s ease; }
        .top-tabs span.active { color: var(--app-blue); font-weight: bold; border-bottom-color: var(--app-blue); }
        .banner, .banner-footer { padding: 5px 0; text-align: center; min-height: 90px; display: flex; justify-content: center; align-items: center; overflow: hidden; }
        .match-list { padding: 15px; }
        .date-header { color: var(--text-secondary); font-size: 13px; margin: 10px 5px 15px; font-weight: 600; }
        .match-card { background-color: var(--bg-secondary); border-radius: 12px; box-shadow: var(--card-shadow); padding: 18px; margin-bottom: 12px; display: flex; justify-content: space-between; align-items: center; cursor: pointer; transition: all 0.3s ease; }
        .match-card:hover { transform: translateY(-5px); box-shadow: var(--card-hover-shadow); }
        .match-card-content { display: flex; justify-content: space-between; align-items: center; width: 100%; gap: 20px; }
        .match-teams { display: flex; flex-direction: column; align-items: flex-start; gap: 12px; }
        .team { display: flex; align-items: center; justify-content: flex-start; width: 150px; }
        .team span { color: var(--text-primary); font-size: 15px; font-weight: 500; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 110px; }
        .team-logo { width: 30px; height: 30px; background-color: #f0f0f0; border-radius: 50%; display: flex; align-items: center; justify-content: center; overflow: hidden; flex-shrink: 0; margin-left: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .team-logo img { width: 100%; height: 100%; object-fit: contain; }
        .match-time { display: flex; align-items: center; justify-content: center; gap: 10px; font-weight: bold; color: var(--text-primary); }
        .live-glow { color: var(--live-blue); font-weight: bold; font-size: 12px; animation: glow-pulse 1.5s infinite; }
        @keyframes glow-pulse { 0% { text-shadow: 0 0 5px var(--live-blue), 0 0 10px var(--live-blue); } 50% { text-shadow: 0 0 20px var(--live-blue), 0 0 30px var(--live-blue); } 100% { text-shadow: 0 0 5px var(--live-blue), 0 0 10px var(--live-blue); } }
        .score-display { display: flex; flex-direction: column; align-items: center; font-size: 24px; line-height: 1.1; }
        .time-display { font-size: 16px; }
        .account-dashboard { padding: 20px; display: flex; flex-direction: column; gap: 20px; }
        .profile-header { display: flex; flex-direction: column; align-items: center; background-color: var(--bg-secondary); padding: 20px; border-radius: 15px; box-shadow: var(--card-shadow); text-align: center; transition: background-color 0.3s ease; }
        .profile-logo { width: 80px; height: 80px; border-radius: 50%; margin-bottom: 10px; background-color: black; background-image: url('https://d.top4top.io/p_3606tuhk40.png'); background-size: cover; background-position: center; border: 3px solid var(--bg-primary); box-shadow: var(--card-shadow); transition: border-color 0.3s ease;}
        #user-unique-id { color: var(--text-primary); margin-bottom: 5px; font-size: 20px; font-weight: bold; letter-spacing: 2px; }
        .profile-header p { color: var(--text-secondary); font-size: 14px; }
        .dashboard-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .dashboard-card { background-color: var(--bg-secondary); padding: 20px; border-radius: 15px; box-shadow: var(--card-shadow); display: flex; flex-direction: column; align-items: center; text-align: center; cursor: pointer; transition: all 0.3s ease; }
        .dashboard-card:hover { transform: translateY(-5px); box-shadow: var(--card-hover-shadow); }
        .dashboard-card svg { width: 40px; height: 40px; margin-bottom: 10px; fill: var(--app-blue); }
        .dashboard-card h3 { font-size: 16px; color: var(--text-primary); margin-bottom: 5px; }
        .dashboard-card p { font-size: 12px; color: var(--text-secondary); }
        .logout-section { margin-top: 10px; }
        .logout-btn { width: 100%; padding: 15px; background-color: #d32f2f; color: white; border: none; border-radius: 10px; font-size: 16px; font-weight: bold; cursor: pointer; transition: background-color 0.3s ease; }
        .logout-btn:hover { background-color: #b71c1c; }
        .news-list { padding: 15px; display: flex; flex-direction: column; gap: 15px; }
        .news-card { background-color: var(--bg-secondary); border-radius: 12px; box-shadow: var(--card-shadow); overflow: hidden; transition: all 0.3s ease; }
        .news-card:hover { transform: translateY(-5px); box-shadow: var(--card-hover-shadow); }
        .news-card img { width: 100%; height: 180px; object-fit: cover; background-color: #eee; border-bottom: 1px solid var(--border-color); }
        .news-card-body { padding: 15px; }
        .news-card-body h3 { margin: 0 0 8px 0; color: var(--text-primary); }
        .news-card-body p { margin: 0; color: var(--text-secondary); line-height: 1.6; }
        .notifications-list { padding: 15px; display: flex; flex-direction: column; gap: 12px; }
        .notification-card { background-color: var(--bg-secondary); border-radius: 12px; box-shadow: var(--card-shadow); padding: 12px; display: flex; align-items: center; gap: 15px; transition: all 0.3s ease; }
        .notification-card:hover { transform: translateY(-5px); box-shadow: var(--card-hover-shadow); }
        .notification-card-image { width: 50px; height: 50px; border-radius: 50%; object-fit: cover; background-color: #eee; flex-shrink: 0; }
        .notification-card-body { flex-grow: 1; }
        .notification-card-body h3 { margin: 0 0 4px 0; color: var(--text-primary); font-size: 16px; font-weight: 600; }
        .notification-card-body p { margin: 0; color: var(--text-secondary); line-height: 1.5; font-size: 14px; }
        .loader { border: 4px solid var(--bg-secondary); border-top: 4px solid var(--app-blue); border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 50px auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .message { text-align: center; color: var(--text-secondary); padding: 50px 20px; font-size: 16px; }
        .bottom-nav { background: var(--bottom-nav-bg); display: flex; justify-content: space-around; padding: 10px 0; border-top: 1px solid var(--border-color); position: fixed; bottom: 0; left: 0; right: 0; width: 100%; max-width: 420px; height: var(--footer-height); z-index: 1000; margin: 0 auto; border-radius: 20px 20px 0 0; box-shadow: 0 -2px 10px rgba(0,0,0,0.05); transition: background-color 0.3s ease, border-color 0.3s ease;}
        .bottom-nav-item { position: relative; display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; color: var(--text-secondary); transition: all 0.2s ease-in-out; flex: 1; text-align: center; }
        .bottom-nav-item.active { color: var(--app-blue); }
        .bottom-nav-item svg { width: 30px; height: 30px; margin-bottom: 2px; fill: currentColor; }
        .bottom-nav-item span { font-size: 12px; font-weight: 500; }
        .nav-counter { position: absolute; top: 0px; right: calc(50% - 25px); background-color: #d32f2f; color: white; border-radius: 50%; width: 18px; height: 18px; font-size: 11px; font-weight: bold; display: none; align-items: center; justify-content: center; border: 2px solid var(--bg-secondary); }
        .nav-counter.visible { display: flex; }
        .setting-item { display: flex; justify-content: space-between; align-items: center; width: 100%; }
        .switch { position: relative; display: inline-block; width: 50px; height: 28px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 34px; }
        .slider:before { position: absolute; content: ""; height: 20px; width: 20px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--app-blue); }
        input:checked + .slider:before { transform: translateX(22px); }
        .auth-forms { padding: 20px; }
        .auth-toggle { display: flex; border: 1px solid var(--border-color); border-radius: 10px; margin-bottom: 20px; }
        .toggle-btn { flex: 1; padding: 12px; background-color: transparent; border: none; font-size: 16px; color: var(--text-secondary); cursor: pointer; transition: all 0.3s ease; }
        .toggle-btn.active { background-color: var(--app-blue); color: white; border-radius: 8px; box-shadow: 0 4px 8px rgba(25, 118, 210, 0.3); }
        .input-group { margin-bottom: 15px; }
        .input-group label { display: block; margin-bottom: 5px; color: var(--text-secondary); font-size: 14px; }
        .input-group input { width: 100%; padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; background-color: var(--bg-primary); color: var(--text-primary); }
        .auth-button { width: 100%; padding: 15px; background-color: var(--app-blue); color: white; border: none; border-radius: 10px; font-size: 16px; font-weight: bold; cursor: pointer; margin-top: 10px; }
    </style>
</head>
<body>
    <div class="mobile-container" id="mobile-container">
        <!-- Header -->
        <header class="header">
             <div class="header-left"><div class="app-logo"></div></div>
            <div class="search-bar"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"></circle><path d="m21 21-4.35-4.35"></path></svg><input type="text" placeholder="بحث في ٦٨٠koora"></div>
            <div class="header-right"><div class="lightning-icon"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/></svg></div></div>
        </header>
        <!-- Content Wrapper -->
        <div class="content-wrapper">
            <div id="matches-page" class="page active">
                <nav class="top-tabs"><span class="active">الرئيسية</span><span>المحولات</span><span>المزيد</span></nav>
                <div class="banner"><script>atOptions = {'key' : '2ead91564181f5f48a4bdd258aed7f73','format' : 'iframe','height' : 90,'width' : 728,'params' : {}}; </script><script src="//www.highperformanceformat.com/2ead91564181f5f48a4bdd258aed7f73/invoke.js"></script></div>
                <main class="match-list" id="match-list-container"><div class="loader"></div></main>
                <div class="banner-footer"><script>atOptions = {'key' : 'd0f3c4203f36a44a0816235108a8464b','format' : 'iframe','height' : 50,'width' : 320,'params' : {}}; </script><script src="//www.highperformanceformat.com/d0f3c4203f36a44a0816235108a8464b/invoke.js"></script></div>
            </div>
            <div id="news-page" class="page"><div class="news-list" id="news-list-container"><div class="loader"></div></div></div>
            <div id="notifications-page" class="page"><div class="notifications-list" id="notifications-list-container"><div class="loader"></div></div></div>
            <div id="account-page" class="page">
                 <div class="account-dashboard">
                    <div id="logged-in-view" style="display: none;">
                        <div class="profile-header"><div class="profile-logo"></div><h2 id="user-unique-id">#00000000</h2><p id="user-email">email@example.com</p></div>
                        <div class="dashboard-grid"><div class="dashboard-card"><svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px"><path d="M0 0h24v24H0z" fill="none"/><path d="M12 22c1.1 0 2-.9 2-2h-4c0 1.1.89 2 2 2zm6-6v-5c0-3.07-1.64-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.63 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2z"/></svg><h3>الإشعارات</h3><p>آخر التنبيهات</p></div><div class="dashboard-card"><svg viewBox="0 0 24 24"><path d="M12,15.5A3.5,3.5 0 0,1 8.5,12A3.5,3.5 0 0,1 12,8.5A3.5,3.5 0 0,1 15.5,12A3.5,3.5 0 0,1 12,15.5M19.43,12.97C19.47,12.33 19.5,11.67 19.5,11C19.5,9.89 18.61,9 17.5,9H14.68C14.5,7.92 13.6,7 12.5,7C11.4,7 10.5,7.92 10.32,9H7.5C6.39,9 5.5,9.89 5.5,11C5.5,11.67 5.53,12.33 5.57,12.97L3.09,19.2C3.05,19.31 3,19.42 3,19.54C3,20.35 3.66,21 4.48,21H6.5C7.32,21 8,20.35 8,19.54C8,19.42 7.95,19.31 7.91,19.2L10.39,12.97C10.35,12.33 10.32,11.67 10.32,11C10.32,9.89 11.21,9 12.32,9C13.43,9 14.32,9.89 14.32,11C14.32,11.67 14.29,12.33 14.25,12.97L16.73,19.2C16.69,19.31 16.64,19.42 16.64,19.54C16.64,20.35 17.32,21 18.14,21H20.16C20.98,21 21.66,20.35 21.66,19.54C21.66,19.42 21.61,19.31 21.57,19.2L19.43,12.97Z"/></svg><h3>الإحصائيات</h3><p>بيانات فريقك</p></div></div>
                        <div class="dashboard-card" style="margin-top: 15px; cursor: default;"><div class="setting-item"><h3 style="margin: 0;">المظهر</h3><label class="switch"><input type="checkbox" id="dark-mode-toggle"><span class="slider"></span></label></div></div>
                        <div class="logout-section"><button id="logout-btn" class="logout-btn">تسجيل الخروج</button></div>
                    </div>
                    <div id="auth-forms" style="display: none;" class="auth-forms"><div class="auth-toggle"><button id="login-toggle" class="toggle-btn active">تسجيل الدخول</button><button id="signup-toggle" class="toggle-btn">إنشاء حساب</button></div><form id="login-form"><div class="input-group"><label for="login-email">البريد الإلكتروني</label><input type="email" id="login-email" required></div><div class="input-group"><label for="login-password">كلمة المرور</label><input type="password" id="login-password" required></div><button type="submit" class="auth-button">دخول</button></form><form id="signup-form" style="display: none;"><div class="input-group"><label for="signup-email">البريد الإلكتروني</label><input type="email" id="signup-email" required></div><div class="input-group"><label for="signup-password">كلمة المرور</label><input type="password" id="signup-password" required></div><button type="submit" class="auth-button">إنشاء حساب</button></form></div>
                 </div>
            </div>
        </div>
        <!-- Bottom Nav -->
        <nav class="bottom-nav">
             <div class="bottom-nav-item active" id="nav-matches"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,4A8,8 0 0,1 20,12A8,8 0 0,1 12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4M12,6A6,6 0 0,0 6,12A6,6 0 0,0 12,18A6,6 0 0,0 18,12A6,6 0 0,0 12,6M12,8A4,4 0 0,1 16,12A4,4 0 0,1 12,16A4,4 0 0,1 8,12A4,4 0 0,1 12,8Z"/></svg><span>كرة القدم</span></div>
            <div class="bottom-nav-item" id="nav-news"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M3,11H11V3H3M3,21H11V13H3M13,21H21V13H13M13,3V11H21V3"/></svg><span>المحتوى</span></div>
            <div class="bottom-nav-item" id="nav-notifications"><span class="nav-counter" id="notification-counter"></span><svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="currentColor"><path d="M0 0h24v24H0z" fill="none"/><path d="M12 22c1.1 0 2-.9 2-2h-4c0 1.1.89 2 2 2zm6-6v-5c0-3.07-1.64-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.63 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2z"/></svg><span>الإشعارات</span></div>
            <div class="bottom-nav-item" id="nav-account"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12,4A4,4 0 0,1 16,8A4,4 0 0,1 12,12A4,4 0 0,1 8,8A4,4 0 0,1 12,4M12,14C16.42,14 20,15.79 20,18V20A2,2 0 0,1 18,22H6A2,2 0 0,1 4,20V18C4,15.79 7.58,14 12,14Z" /></svg><span>حسابي</span></div>
        </nav>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const firebaseConfig = { apiKey: "AIzaSyAvrXtHEB_ygqN9h-XHOgLug_3aCh63NwQ", authDomain: "test-amin-99f09.firebaseapp.com", databaseURL: "https://test-amin-99f09-default-rtdb.firebaseio.com", projectId: "test-amin-99f09", storageBucket: "test-amin-99f09.firebasestorage.app", messagingSenderId: "113688386317", appId: "1:113688386317:web:19d0bb843fa1c07d90ae44"};
            firebase.initializeApp(firebaseConfig);
            const auth = firebase.auth(); const db = firebase.database();
            const pages = { matches: document.getElementById('matches-page'), news: document.getElementById('news-page'), notifications: document.getElementById('notifications-page'), account: document.getElementById('account-page') };
            const navItems = { matches: document.getElementById('nav-matches'), news: document.getElementById('nav-news'), notifications: document.getElementById('nav-notifications'), account: document.getElementById('nav-account') };
            const notificationCounterEl = document.getElementById('notification-counter');
            let updateInterval = null; let lastNotificationCount = localStorage.getItem('lastNotificationCount') || 0;
            const mobileContainer = document.getElementById('mobile-container'); const darkModeToggle = document.getElementById('dark-mode-toggle'); const enableDarkMode = () => { mobileContainer.classList.add('dark-mode'); localStorage.setItem('darkMode', 'enabled'); darkModeToggle.checked = true; }; const disableDarkMode = () => { mobileContainer.classList.remove('dark-mode'); localStorage.setItem('darkMode', 'disabled'); darkModeToggle.checked = false; }; if (localStorage.getItem('darkMode') === 'enabled') { enableDarkMode(); }
            darkModeToggle.addEventListener('change', () => { darkModeToggle.checked ? enableDarkMode() : disableDarkMode(); });

            function showPage(pageKey) {
                Object.values(pages).forEach(p => p.classList.remove('active'));
                Object.values(navItems).forEach(i => i.classList.remove('active'));
                pages[pageKey].classList.add('active'); navItems[pageKey].classList.add('active');
                if (pageKey === 'matches') startLiveUpdates(); else stopLiveUpdates();
                if (pageKey === 'news' && !pages.news.hasAttribute('data-loaded')) displayNews();
                if (pageKey === 'notifications') { if (!pages.notifications.hasAttribute('data-loaded')) displayNotifications(); lastNotificationCount = notificationCounterEl.dataset.totalCount || 0; localStorage.setItem('lastNotificationCount', lastNotificationCount); updateNotificationBadge(); }
            }
            Object.keys(navItems).forEach(key => navItems[key].addEventListener('click', () => showPage(key)));

            function updateNotificationBadge() {
                const totalCount = parseInt(notificationCounterEl.dataset.totalCount) || 0;
                const unreadCount = totalCount - lastNotificationCount;
                if (unreadCount > 0) { notificationCounterEl.textContent = unreadCount; notificationCounterEl.classList.add('visible'); } else { notificationCounterEl.classList.remove('visible'); }
            }
            db.ref('notifications').on('value', snapshot => { notificationCounterEl.dataset.totalCount = snapshot.numChildren(); updateNotificationBadge(); });
            
            const placeholderImage = 'https://d.top4top.io/p_3606tuhk40.png';
            const displayNews = () => { const container = document.getElementById('news-list-container'); pages.news.setAttribute('data-loaded', 'true'); db.ref('news').orderByChild('timestamp').on('value', snapshot => { if (!snapshot.exists()) { container.innerHTML = '<p class="message">لا يوجد أخبار حاليًا.</p>'; return; } let itemsHtml = ''; snapshot.forEach(child => { const news = child.val(); itemsHtml = `<div class="news-card">${news.image ? `<img src="${news.image}" alt="">` : ''}<div class="news-card-body"><h3>${news.title}</h3><p>${news.content}</p></div></div>` + itemsHtml; }); container.innerHTML = itemsHtml; }); };
            const displayNotifications = () => { const container = document.getElementById('notifications-list-container'); pages.notifications.setAttribute('data-loaded', 'true'); db.ref('notifications').orderByChild('timestamp').on('value', snapshot => { if (!snapshot.exists()) { container.innerHTML = '<p class="message">لا توجد إشعارات جديدة.</p>'; return; } let itemsHtml = ''; snapshot.forEach(child => { const notification = child.val(); const imageUrl = notification.image && notification.image.trim() !== '' ? notification.image : placeholderImage; itemsHtml = `<div class="notification-card"><img src="${imageUrl}" class="notification-card-image" alt=""><div class="notification-card-body"><h3>${notification.title}</h3><p>${notification.content}</p></div></div>` + itemsHtml; }); container.innerHTML = itemsHtml; }); };
            
            const loggedInView = document.getElementById('logged-in-view'); const authForms = document.getElementById('auth-forms'); const userUniqueIDEl = document.getElementById('user-unique-id'); const userEmailEl = document.getElementById('user-email'); const loginForm = document.getElementById('login-form'); const signupForm = document.getElementById('signup-form'); const loginToggle = document.getElementById('login-toggle'); const signupToggle = document.getElementById('signup-toggle'); const logoutBtn = document.getElementById('logout-btn'); const generateUniqueID = () => String(Math.floor(10000000 + Math.random() * 90000000));
            
            // --- ⭐ الكود المصحح يبدأ هنا --- ⭐
            auth.onAuthStateChanged(user => {
                if (user) {
                    loggedInView.style.display = 'block';
                    authForms.style.display = 'none';
                    const userRef = db.ref('users/' + user.uid);
                    userRef.once('value').then(snapshot => {
                        let userData = snapshot.val();
                        // هذا الكود يعمل كإجراء وقائي للمستخدمين القدامى الذين ليس لديهم سجل
                        if (!userData || !userData.uniqueID) {
                            const newID = generateUniqueID();
                            const newUserData = { email: user.email, uniqueID: newID };
                            userRef.set(newUserData); 
                            userData = newUserData;
                        }
                        userUniqueIDEl.textContent = `#${userData.uniqueID}`;
                        userEmailEl.textContent = user.email;
                    });
                } else {
                    loggedInView.style.display = 'none';
                    authForms.style.display = 'block';
                }
            });

            loginToggle.addEventListener('click', () => { loginForm.style.display = 'block'; signupForm.style.display = 'none'; loginToggle.classList.add('active'); signupToggle.classList.remove('active'); });
            signupToggle.addEventListener('click', () => { signupForm.style.display = 'block'; loginForm.style.display = 'none'; signupToggle.classList.add('active'); loginToggle.classList.remove('active'); });
            
            signupForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const email = signupForm['signup-email'].value;
                const password = signupForm['signup-password'].value;
                auth.createUserWithEmailAndPassword(email, password)
                    .then((userCredential) => {
                        const user = userCredential.user;
                        const newID = generateUniqueID();
                        // الخطوة الحاسمة: إنشاء سجل في قاعدة البيانات فورًا بعد إنشاء الحساب
                        return db.ref('users/' + user.uid).set({
                            email: user.email,
                            uniqueID: newID
                        });
                    })
                    .catch(err => {
                        alert(err.message);
                    });
            });
            // --- ⭐ الكود المصحح ينتهي هنا --- ⭐

            loginForm.addEventListener('submit', (e) => { e.preventDefault(); auth.signInWithEmailAndPassword(loginForm['login-email'].value, loginForm['login-password'].value).catch(err => alert(err.message)); });
            logoutBtn.addEventListener('click', () => auth.signOut());
            
            const API_BASE_URL = "https://ws.kora-api.top/api/matches/", API_TEAM_URL = "https://ws.kora-api.top/uploads/team/", matchListContainer = document.getElementById('match-list-container'); const getFormattedDate = () => new Date().toISOString().slice(0, 10); const fetchMatches = async () => { try { const r = await fetch(`${API_BASE_URL}${getFormattedDate()}?cb=${new Date().getTime()}`); if (!r.ok) throw new Error(); displayMatches(await r.json()); } catch (e) { matchListContainer.innerHTML = `<div class="message">حدث خطأ.</div>`; } }; const displayMatches = (matches) => { if (!matches || matches.length === 0) { matchListContainer.innerHTML = `<div class="message">لا توجد مباريات اليوم.</div>`; return; } let html = `<div class="date-header">مباريات اليوم • ${getFormattedDate()}</div>`; let matchesToShow = matches.filter(m => m.sport_name === 'كرة القدم').length > 0 ? matches.filter(m => m.sport_name === 'كرة القدم') : matches; matchesToShow.forEach(match => { const hL = match.home_logo ? `${API_TEAM_URL}${match.home_logo}` : '', aL = match.away_logo ? `${API_TEAM_URL}${match.away_logo}` : ''; let lS = '', sT = ''; switch (match.status) { case 1: const p = (match.score||'0-0').split('-'); sT=`<div class="score-display"><span>${p[0]||'0'}</span><span>-</span><span>${p[1]||'0'}</span></div>`; lS=`<span class="live-glow">مباشر</span>`; break; case 2: const f = (match.score||'0-0').split('-'); sT=`<div class="score-display"><span>${f[0]||'0'}</span><span>-</span><span>${f[1]||'0'}</span></div>`; break; default: sT = `<div class="time-display">${match.time || 'VS'}</div>`; } html += `<div class="match-card"><div class="match-card-content"><div class="match-teams"><div class="team"><div class="team-logo"><img src="${hL}" alt="${match.home}" onerror="this.style.display='none'"></div><span>${match.home}</span></div><div class="team"><div class="team-logo"><img src="${aL}" alt="${match.away}" onerror="this.style.display='none'"></div><span>${match.away}</span></div></div><div class="match-time">${lS}${sT}</div></div></div>`; }); matchListContainer.innerHTML = html; };
            const startLiveUpdates = () => { fetchMatches(); if (updateInterval) clearInterval(updateInterval); updateInterval = setInterval(fetchMatches, 30000); }; const stopLiveUpdates = () => { if (updateInterval) clearInterval(updateInterval); };

            showPage('matches');
        });
    </script>
</body>
</html>